<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Tabletop.js</title>
	
	<!-- 利用Tabletop.JS讀取Google Sheet https://github.com/jsoma/tabletop -->
	<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
	<script type='text/javascript'> 
	
	
		//取得網址裡的參數
		function GetUrlVar(VarName)
		{
		  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		  var regexS = "[\\?&]" + VarName + "=([^&#]*)";
		  var regex = new RegExp(regexS);
		  var results = regex.exec(window.location.href);
		  if(results == null)
			return "";
		  else
			return results[1];
		}
		
	
		  // 於Google Spreadsheet建立的範例資料為 https://docs.google.com/spreadsheets/d/e/2PACX-1vR9LivzlVjV3Mp9EOw0rCh46tDacBY6uQ8AT4k6ObLecvL8P-BpgKza9IOyGfFkP3tEdNSereSt8wxT/pubhtml
	  var publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1vV4DPIkxp98bzHbu1KshJCd-c2uYqgTsPBz-T1G8fxQ/pubhtml';

	  function init() {
		Tabletop.init( { key: publicSpreadsheetUrl,
						 callback: showInfo,
						 simpleSheet: true } )
	  }

	  function showInfo(data, tabletop) {
		// alert('Successfully processed!')
		console.log(data);
		
		var i = decodeURIComponent(GetUrlVar('pid'));
		
		var str = "";
		//var windowOpen = windowRef.location.href(data[i].href);
		var windowOpen = window.open(data[i].bookstore);
		if (windowOpen == null || typeof(windowOpen)=='undefined'){
        $('#feedback').html('已觸發：視窗無法開啟，請檢查你的瀏覽器設定。')
		} else {
        $('#feedback').html('已觸發：視窗開啟成功了')
		}  
				
	
	
		document.getElementById("demo").innerHTML = windowOpen;
	  }

	  window.addEventListener('DOMContentLoaded', init)
	</script>
<head>

<body>


	<div id="demo">
	
	</div>
</body>
</html>